{"ast":null,"code":"import * as firebase from \"firebase\";\nimport \"firebase/database\";\nvar config = {\n  apiKey: \"AIzaSyDp01-0TwxRjNC05CuDcpauXRyLSMv0RRw\",\n  authDomain: \"darts-yeslab.firebaseapp.com\",\n  databaseURL: \"https://darts-yeslab.firebaseio.com\",\n  projectId: \"darts-yeslab\",\n  storageBucket: \"darts-yeslab.appspot.com\",\n  messagingSenderId: \"426404952698\",\n  appId: \"1:426404952698:web:738ac9ab1342a1177419c3\",\n  measurementId: \"G-7DHLMBZXEN\"\n};\n\nif (!firebase.apps.length) {\n  firebase.initializeApp(config);\n  firebase.database();\n} // DB types\n\n\nexport function getUser(userId) {\n  return firebase.database().ref(\"/users/\" + userId).once(\"value\").then(function (snapshot) {\n    var user = snapshot.val();\n    console.log(\"user\", user);\n\n    if (user) {\n      return user;\n    }\n\n    return createUser(userId);\n  });\n}\n\nfunction createUser(userId) {\n  var user = {\n    id: userId\n  };\n  console.log(\"create user for: \", userId);\n  return firebase.database().ref(\"users/\" + userId).set(user, function (error) {\n    if (error) {\n      console.log(\"error\", error);\n      throw new Error(error.message);\n    }\n\n    return user;\n  });\n} // const data = {\n//   games: {\n//     \"one\": {\n//       creator: \"user_id\",\n//       timestamp: 000,\n//       code: \"7yzh\"\n//     },\n//     \"two\": {\n//       creator: \"user_id\",\n//       timestamp: 000,\n//       code: \"8n0a\"\n//     }\n//   }\n// }","map":{"version":3,"sources":["/Users/sean/Workspace/darts/api/firebase.ts"],"names":["firebase","config","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","apps","length","initializeApp","database","getUser","userId","ref","once","then","snapshot","user","val","console","log","createUser","id","set","error","Error","message"],"mappings":"AAAA,OAAO,KAAKA,QAAZ,MAA0B,UAA1B;AACA,OAAO,mBAAP;AAEA,IAAMC,MAAM,GAAG;AACbC,EAAAA,MAAM,EAAE,yCADK;AAEbC,EAAAA,UAAU,EAAE,8BAFC;AAGbC,EAAAA,WAAW,EAAE,qCAHA;AAIbC,EAAAA,SAAS,EAAE,cAJE;AAKbC,EAAAA,aAAa,EAAE,0BALF;AAMbC,EAAAA,iBAAiB,EAAE,cANN;AAObC,EAAAA,KAAK,EAAE,2CAPM;AAQbC,EAAAA,aAAa,EAAE;AARF,CAAf;;AAWA,IAAI,CAACT,QAAQ,CAACU,IAAT,CAAcC,MAAnB,EAA2B;AACzBX,EAAAA,QAAQ,CAACY,aAAT,CAAuBX,MAAvB;AACAD,EAAAA,QAAQ,CAACa,QAAT;AACD,C,CAED;;;AAOA,OAAO,SAASC,OAAT,CAAiBC,MAAjB,EAAgD;AACrD,SAAOf,QAAQ,CACZa,QADI,GAEJG,GAFI,CAEA,YAAYD,MAFZ,EAGJE,IAHI,CAGC,OAHD,EAIJC,IAJI,CAIC,UAASC,QAAT,EAAmB;AACvB,QAAMC,IAAI,GAAGD,QAAQ,CAACE,GAAT,EAAb;AACAC,IAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ,EAAoBH,IAApB;;AACA,QAAIA,IAAJ,EAAU;AACR,aAAOA,IAAP;AACD;;AAED,WAAOI,UAAU,CAACT,MAAD,CAAjB;AACD,GAZI,CAAP;AAaD;;AAED,SAASS,UAAT,CAAoBT,MAApB,EAA2C;AACzC,MAAMK,IAAU,GAAG;AACjBK,IAAAA,EAAE,EAAEV;AADa,GAAnB;AAIAO,EAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ,EAAiCR,MAAjC;AACA,SAAOf,QAAQ,CACZa,QADI,GAEJG,GAFI,CAEA,WAAWD,MAFX,EAGJW,GAHI,CAGAN,IAHA,EAGM,UAAAO,KAAK,EAAI;AAClB,QAAIA,KAAJ,EAAW;AACTL,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBI,KAArB;AACA,YAAM,IAAIC,KAAJ,CAAUD,KAAK,CAACE,OAAhB,CAAN;AACD;;AAED,WAAOT,IAAP;AACD,GAVI,CAAP;AAWD,C,CAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA","sourcesContent":["import * as firebase from \"firebase\";\nimport \"firebase/database\";\n\nconst config = {\n  apiKey: \"AIzaSyDp01-0TwxRjNC05CuDcpauXRyLSMv0RRw\",\n  authDomain: \"darts-yeslab.firebaseapp.com\",\n  databaseURL: \"https://darts-yeslab.firebaseio.com\",\n  projectId: \"darts-yeslab\",\n  storageBucket: \"darts-yeslab.appspot.com\",\n  messagingSenderId: \"426404952698\",\n  appId: \"1:426404952698:web:738ac9ab1342a1177419c3\",\n  measurementId: \"G-7DHLMBZXEN\"\n};\n\nif (!firebase.apps.length) {\n  firebase.initializeApp(config);\n  firebase.database();\n}\n\n// DB types\ndeclare global {\n  interface User {\n    // id: string;\n  }\n}\n\nexport function getUser(userId: string): Promise<User> {\n  return firebase\n    .database()\n    .ref(\"/users/\" + userId)\n    .once(\"value\")\n    .then(function(snapshot) {\n      const user = snapshot.val();\n      console.log(\"user\", user);\n      if (user) {\n        return user;\n      }\n\n      return createUser(userId);\n    });\n}\n\nfunction createUser(userId): Promise<User> {\n  const user: User = {\n    id: userId\n  };\n\n  console.log(\"create user for: \", userId);\n  return firebase\n    .database()\n    .ref(\"users/\" + userId)\n    .set(user, error => {\n      if (error) {\n        console.log(\"error\", error);\n        throw new Error(error.message);\n      }\n\n      return user;\n    });\n}\n\n// const data = {\n//   games: {\n//     \"one\": {\n//       creator: \"user_id\",\n//       timestamp: 000,\n//       code: \"7yzh\"\n//     },\n//     \"two\": {\n//       creator: \"user_id\",\n//       timestamp: 000,\n//       code: \"8n0a\"\n//     }\n//   }\n\n// }\n"]},"metadata":{},"sourceType":"module"}