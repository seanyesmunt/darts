{"version":3,"file":"static/webpack/static/development/pages/game/[id].js.2a2aadc17339e43cf419.hot-update.js","sources":["webpack:///./api/firebase.ts","webpack:///./effects/game.ts","webpack:///./pages/game/.tsx"],"sourcesContent":["import * as firebase from \"firebase/app\";\nimport \"firebase/database\";\n\nconst config = {\n  apiKey: \"AIzaSyDp01-0TwxRjNC05CuDcpauXRyLSMv0RRw\",\n  authDomain: \"darts-yeslab.firebaseapp.com\",\n  databaseURL: \"https://darts-yeslab.firebaseio.com\",\n  projectId: \"darts-yeslab\",\n  storageBucket: \"darts-yeslab.appspot.com\",\n  messagingSenderId: \"426404952698\",\n  appId: \"1:426404952698:web:738ac9ab1342a1177419c3\",\n  measurementId: \"G-7DHLMBZXEN\"\n};\n\nif (!firebase.apps.length) {\n  firebase.initializeApp(config);\n}\n\nfirebase.database();\n\n// DB types\ndeclare global {\n  interface User {\n    id: string;\n    created_at: number;\n  }\n\n  interface Game {\n    id: string;\n    creator_id: string;\n    join_id: string;\n  }\n\n  interface Error {\n    message: string;\n  }\n}\n\nexport function getUser(userID: string): Promise<User> {\n  return firebase\n    .database()\n    .ref(\"/users/\" + userID)\n    .once(\"value\")\n    .then(function(snapshot) {\n      const user = snapshot.val();\n      if (user) {\n        return { ...user, id: userID };\n      }\n\n      return createUser(userID);\n    });\n}\n\nfunction createUser(userID): Promise<User> {\n  const user = {\n    created_at: Date.now()\n  };\n\n  return new Promise((resolve, reject) => {\n    firebase\n      .database()\n      .ref(\"users/\" + userID)\n      .set(user, error => {\n        if (error) {\n          reject(error);\n        }\n\n        resolve({ ...user, id: userID });\n      });\n  });\n}\n\nexport function getGame(gameID: string, userID: string): Promise<Game> {\n  return firebase\n    .database()\n    .ref(\"/games/\" + gameID)\n    .once(\"value\")\n    .then(function(snapshot) {\n      const game = snapshot.val();\n      if (game) {\n        return { ...game, id: gameID };\n      }\n\n      return createGame(gameID, userID);\n    });\n}\n\nexport function getGameId(join_id: string): Promise<string> {\n  return new Promise((resolve, reject) => {\n    firebase\n      .database()\n      .ref(\"games\")\n      .orderByChild(\"join_id\")\n      .equalTo(join_id)\n      .on(\"value\", function(snapshot) {\n        snapshot.forEach(function(data) {\n          const id = data.key;\n          if (!id) {\n            reject(\"Game not found.\");\n          } else {\n            resolve(id);\n          }\n        });\n      });\n  });\n}\n\nfunction createGame(gameID, userId): Promise<Game> {\n  const game = {\n    creator_id: userId,\n    join_id: gameID.slice(0, 4)\n  };\n\n  return new Promise((resolve, reject) => {\n    firebase\n      .database()\n      .ref(\"games/\" + gameID)\n      .set(game, error => {\n        if (error) {\n          reject(error);\n        } else {\n          resolve({ ...game, id: gameID });\n        }\n      });\n  });\n}\n\n// const data = {\n//   games: {\n//     \"one\": {\n//       creator: \"user_id\",\n//       timestamp: 000,\n//       code: \"7yzh\"\n//     },\n//     \"two\": {\n//       creator: \"user_id\",\n//       timestamp: 000,\n//       code: \"8n0a\"\n//     }\n//   }\n\n// }\n","import React from \"react\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport Cookies from \"js-cookie\";\nimport { getGame } from \"../api/firebase\";\nimport { useGetUserID } from \"./user\";\n\nconst GAME_ID = \"game_id\";\n\nexport function useGetGame(gameIDFromUrl): [Game, Error?] {\n  console.log(\"gameID\", gameIDFromUrl);\n  const userID = useGetUserID();\n  const [gameID, setgameID] = React.useState<string>(gameIDFromUrl);\n  const [game, setGame] = React.useState<Game>();\n  const [error, setError] = React.useState<Error>();\n\n  React.useEffect(() => {\n    if (gameIDFromUrl) {\n      setgameID(gameIDFromUrl);\n      Cookies.set(GAME_ID, gameIDFromUrl, {\n        expires: 365\n      });\n\n      setgameID(gameIDFromUrl);\n    } else {\n      const gameIDCookie = Cookies.get(GAME_ID);\n      if (gameIDCookie) {\n        setgameID(gameIDCookie);\n      } else {\n        const newId = uuidv4();\n        Cookies.set(GAME_ID, newId, {\n          expires: 365\n        });\n\n        setgameID(newId);\n      }\n    }\n  }, [gameIDFromUrl]);\n\n  React.useEffect(() => {\n    if (gameID && userID) {\n      getGame(gameID, userID)\n        .then(gameFromDB => {\n          setGame(gameFromDB);\n        })\n        .catch(error => {\n          setError(error);\n        });\n    }\n  }, [gameID, userID]);\n\n  return [game, error];\n}\n\nexport function useGetGameID(): string {\n  const [game] = useGetGame(undefined);\n  const gameID = game && game.id;\n\n  return gameID;\n}\n","import Link from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport { useGetGame } from \"../../effects/game\";\n\ninterface Props {\n  game?: Game;\n}\n\nexport default function Game(props: Props) {\n  const router = useRouter();\n  const { id } = router.query;\n  const [game] = useGetGame(id);\n  console.log(\"game\", game);\n\n  return (\n    <div>\n      <main>{game && <div>ID: {game.join_id}</div>}</main>\n    </div>\n  );\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AACA;AAUA;AACA;AACA;AACA;AACA;AACA;AAmBA;AACA;AAKA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAIA;AACA;AAIA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAKA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAMA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAKA;AACA;AAIA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;AC7IA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAHA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAMA;AACA;AACA;AACA;AACA;AADA;AAIA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AADA;AAIA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACzDA;AACA;AAMA;AACA;AADA;AACA;AADA;AAAA;AAAA;AACA;AAGA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;;;;A","sourceRoot":""}